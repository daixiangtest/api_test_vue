"use strict";(self["webpackChunkapi_test_vue"]=self["webpackChunkapi_test_vue"]||[]).push([[396],{2469:function(e,a,l){l.d(a,{N:function(){return n}});var t=l(2261),s=l(1552);const n=(0,t.nY)("proStore",{state:()=>({pro:{},env_list:[],env:0,inetrfaces:[],sceneList:[],taskList:[]}),getters:{interface1(){return this.inetrfaces.filter((e=>"1"===e.type))},interface2(){return this.inetrfaces.filter((e=>"2"===e.type))}},actions:{async getInterFaces(){const e=await s.A.getInterFaces(this.pro.id);200===e.status?this.inetrfaces=e.data:console.log(`获取项目id${this.pro.id}失败`)},async getScenes(){const e=await s.A.getScenes(this.pro.id);200===e.status&&(this.sceneList=e.data)},async getTestTask(){const e=await s.A.getTestTaskList(this.pro.id);200===e.status&&(this.taskList=e.data)}},persist:{enabled:!0,strategies:{key:"users",storage:localStorage}}})},396:function(e,a,l){l.r(a),l.d(a,{default:function(){return F}});var t=l(6768),s=l(144),n=l(4232),o=l(1753),i=l(1552),u=l(2469),d=l(3923),r=l(1219),c=l(2933);const p={class:"main_box"},m={class:"card left_box"},b={class:"title_box"},v={class:"dialog-footer"},f={class:"card center_box"},g={class:"button_box"},k={class:"card right_box"};var h={__name:"TestEnvView",setup(e){var a=(0,s.KR)([]),l=(0,u.N)();async function h(){const e=l.pro.id,t=await i.A.getTestEnvList(e);200===t.status&&(a.value=t.data,l.env_list=t.data)}const _=(0,s.KR)(!1),y=(0,s.Kh)({name:"",host:"",project:""});function F(){_.value=!1,y.name="",y.host=""}function V(){_.value=!0}const w=(0,s.KR)();function x(e){e.validate((async function(e){if(e){y.project=l.pro.id;var a=await i.A.addTestEnv(y);201===a.status?((0,r.nk)({type:"success",message:"添加成功"}),h(),_.value=!1,y.name="",y.host=""):(0,r.nk)({type:"error",message:"添加失败"})}}))}const R=(0,s.Kh)({name:[{required:!0,message:"项目名称不能为空",trigger:"blur"}],host:[{required:!0,message:"环境域名不能为空",trigger:"blur"},{required:!0,pattern:/^(https?:\/\/[^\s]+)$/,message:"URL格式不正确，必须以http://或https://开头",trigger:["blur","change"]}]});var C=(0,s.KR)(""),L=(0,s.KR)(""),T=(0,s.KR)("{}"),W=(0,s.KR)("[]"),A=(0,s.KR)("{}"),K=(0,s.KR)("{}"),S=(0,s.KR)(""),U=(0,s.KR)({id:1});function N(e){U.value=e,C.value=e.name,L.value=e.host,T.value=JSON.stringify(e.headers,0,4)||"{}",W.value=JSON.stringify(e.db,0,4)||"[]",A.value=JSON.stringify(e.global_variable,0,4)||"{}",K.value=JSON.stringify(e.debug_global_variable,0,4)||"{}",S.value=e.global_func}function E(){c.s.confirm("项目环境删除后数据不可恢复，确认删除吗？","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{var e=await i.A.delTestEnv(U.value.id);204===e.status&&(h(),(0,r.nk)({type:"success",message:"删除成功"}),a.value.length>0&&N(a.value[0]))})).catch((()=>{(0,r.nk)({type:"info",message:"已取消"})}))}async function J(){var e=U.value;e.name=U.value.name+"copy";var a=await i.A.addTestEnv(e);201===a.status?((0,r.nk)({type:"success",message:"复制成功"}),h()):(0,r.nk)({type:"error",message:"复制失败"})}async function O(){var e=U.value.id,a={name:C.value,host:L.value,headers:JSON.parse(T.value),db:JSON.parse(W.value),global_variable:JSON.parse(A.value),debug_global_variable:JSON.parse(K.value),global_func:S.value},l=await i.A.updateTestEnv(e,a);200===l.status?((0,r.nk)({type:"success",message:"更新成功"}),h()):((0,r.nk)({type:"error",message:"更新失败"}),h())}return(0,t.sV)((async()=>{await h(),a.value.length>0&&N(a.value[0])})),(e,l)=>{const i=(0,t.g2)("el-button"),u=(0,t.g2)("el-icon"),r=(0,t.g2)("el-menu-item"),c=(0,t.g2)("el-menu"),h=(0,t.g2)("el-input"),j=(0,t.g2)("el-form-item"),z=(0,t.g2)("el-form"),I=(0,t.g2)("el-dialog"),q=(0,t.g2)("el-divider"),B=(0,t.g2)("el-tab-pane"),X=(0,t.g2)("el-tabs"),H=(0,t.g2)("el-affix");return(0,t.uX)(),(0,t.CE)("div",p,[(0,t.Lk)("div",m,[(0,t.Lk)("div",b,[l[13]||(l[13]=(0,t.Lk)("img",{src:o,width:"25"},null,-1)),l[14]||(l[14]=(0,t.Lk)("div",{class:"name"},"测试环境",-1)),(0,t.bF)(i,{type:"primary",text:"",size:"small",icon:"CirclePlus",onClick:V},{default:(0,t.k6)((()=>l[12]||(l[12]=[(0,t.eW)("添加环境")]))),_:1})]),(0,t.bF)(c,{"default-active":(0,s.R1)(U).id,class:"el-menu-vertical-demo"},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)((0,s.R1)(a),((e,a)=>((0,t.uX)(),(0,t.Wv)(r,{index:e.id,key:a,onClick:a=>N(e)},{default:(0,t.k6)((()=>[(0,t.bF)(u,null,{default:(0,t.k6)((()=>l[15]||(l[15]=[(0,t.Lk)("img",{src:o,width:"15px"},null,-1)]))),_:1}),(0,t.Lk)("span",null,(0,n.v_)(e.name),1)])),_:2},1032,["index","onClick"])))),128))])),_:1},8,["default-active"]),(0,t.bF)(I,{modelValue:_.value,"onUpdate:modelValue":l[3]||(l[3]=e=>_.value=e),title:"添加项目环境",width:"500"},{footer:(0,t.k6)((()=>[(0,t.Lk)("div",v,[(0,t.bF)(i,{onClick:F},{default:(0,t.k6)((()=>l[16]||(l[16]=[(0,t.eW)(" 取消 ")]))),_:1}),(0,t.bF)(i,{type:"primary",onClick:l[2]||(l[2]=e=>x(w.value))},{default:(0,t.k6)((()=>l[17]||(l[17]=[(0,t.eW)(" 确认 ")]))),_:1})])])),default:(0,t.k6)((()=>[(0,t.bF)(z,{model:y,rules:R,ref_key:"data",ref:w},{default:(0,t.k6)((()=>[(0,t.bF)(j,{label:"环境名称","label-width":e.formLabelWidth,prop:"name"},{default:(0,t.k6)((()=>[(0,t.bF)(h,{modelValue:y.name,"onUpdate:modelValue":l[0]||(l[0]=e=>y.name=e),autocomplete:"on"},null,8,["modelValue"])])),_:1},8,["label-width"]),(0,t.bF)(j,{label:"环境域名","label-width":e.formLabelWidth,prop:"host"},{default:(0,t.k6)((()=>[(0,t.bF)(h,{modelValue:y.host,"onUpdate:modelValue":l[1]||(l[1]=e=>y.host=e),autocomplete:"on"},null,8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])]),(0,t.Lk)("div",f,[(0,t.bF)(q,{"content-position":"left"},{default:(0,t.k6)((()=>l[18]||(l[18]=[(0,t.eW)("基本信息")]))),_:1}),(0,t.bF)(h,{modelValue:(0,s.R1)(C),"onUpdate:modelValue":l[4]||(l[4]=e=>(0,s.i9)(C)?C.value=e:C=e),style:{"max-width":"600px"},placeholder:"环境名称"},{prepend:(0,t.k6)((()=>l[19]||(l[19]=[(0,t.eW)("环境名称")]))),_:1},8,["modelValue"]),(0,t.bF)(h,{modelValue:(0,s.R1)(L),"onUpdate:modelValue":l[5]||(l[5]=e=>(0,s.i9)(L)?L.value=e:L=e),style:{"max-width":"600px","margin-top":"5px"},placeholder:"Http://"},{prepend:(0,t.k6)((()=>l[20]||(l[20]=[(0,t.eW)("全局域名")]))),_:1},8,["modelValue"]),(0,t.bF)(q,{"content-position":"left"},{default:(0,t.k6)((()=>l[21]||(l[21]=[(0,t.eW)("请求头\\数据库")]))),_:1}),(0,t.bF)(X,{class:"demo-tabs",onTabClick:e.handleClick},{default:(0,t.k6)((()=>[(0,t.bF)(B,{label:"全局Header"},{default:(0,t.k6)((()=>[(0,t.bF)(d.A,{modelValue:(0,s.R1)(T),"onUpdate:modelValue":l[6]||(l[6]=e=>(0,s.i9)(T)?T.value=e:T=e),height:"200px",lang:"json"},null,8,["modelValue"])])),_:1}),(0,t.bF)(B,{label:"DB配置"},{default:(0,t.k6)((()=>[(0,t.bF)(d.A,{modelValue:(0,s.R1)(W),"onUpdate:modelValue":l[7]||(l[7]=e=>(0,s.i9)(W)?W.value=e:W=e),height:"200px",lang:"json"},null,8,["modelValue"])])),_:1})])),_:1},8,["onTabClick"]),(0,t.bF)(q,{"content-position":"left"},{default:(0,t.k6)((()=>l[22]||(l[22]=[(0,t.eW)("环境变量")]))),_:1}),(0,t.bF)(X,{class:"demo-tabs",onTabClick:e.handleClick},{default:(0,t.k6)((()=>[(0,t.bF)(B,{label:"全局变量"},{default:(0,t.k6)((()=>[(0,t.bF)(d.A,{modelValue:(0,s.R1)(A),"onUpdate:modelValue":l[8]||(l[8]=e=>(0,s.i9)(A)?A.value=e:A=e),lang:"json"},null,8,["modelValue"])])),_:1}),(0,t.bF)(B,{label:"局部变量"},{default:(0,t.k6)((()=>[(0,t.bF)(d.A,{modelValue:(0,s.R1)(K),"onUpdate:modelValue":l[9]||(l[9]=e=>(0,s.i9)(K)?K.value=e:K=e),lang:"json"},null,8,["modelValue"])])),_:1}),(0,t.bF)(H,{offset:40,position:"bottom"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",g,[(0,t.bF)(i,{type:"primary",plain:"",size:"small",onClick:O},{default:(0,t.k6)((()=>l[23]||(l[23]=[(0,t.eW)("保存编辑")]))),_:1}),(0,t.bF)(i,{type:"success",plain:"",size:"small",onClick:J},{default:(0,t.k6)((()=>l[24]||(l[24]=[(0,t.eW)("复制环境")]))),_:1}),(0,t.bF)(i,{type:"danger",plain:"",size:"small",onClick:l[10]||(l[10]=e=>E())},{default:(0,t.k6)((()=>l[25]||(l[25]=[(0,t.eW)("删除环境")]))),_:1})])])),_:1})])),_:1},8,["onTabClick"])]),(0,t.Lk)("div",k,[(0,t.bF)(q,{"content-position":"left"},{default:(0,t.k6)((()=>l[26]||(l[26]=[(0,t.eW)("全局工具函数")]))),_:1}),(0,t.bF)(d.A,{modelValue:(0,s.R1)(S),"onUpdate:modelValue":l[11]||(l[11]=e=>(0,s.i9)(S)?S.value=e:S=e),lang:"python",height:"calc(100% - 50px)"},null,8,["modelValue"])])])}}},_=l(1241);const y=(0,_.A)(h,[["__scopeId","data-v-3d03716a"]]);var F=y}}]);
//# sourceMappingURL=396.6e2b64ac.js.map