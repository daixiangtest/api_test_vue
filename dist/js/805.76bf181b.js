"use strict";(self["webpackChunkapi_test_vue"]=self["webpackChunkapi_test_vue"]||[]).push([[805],{1241:function(e,t){t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[s,n]of t)a[s]=n;return a}},2469:function(e,t,a){a.d(t,{N:function(){return l}});var s=a(2261),n=a(1552);const l=(0,s.nY)("proStore",{state:()=>({pro:{},env_list:[],env:0,inetrfaces:[],sceneList:[],taskList:[]}),getters:{interface1(){return this.inetrfaces.filter((e=>"1"===e.type))},interface2(){return this.inetrfaces.filter((e=>"2"===e.type))}},actions:{async getInterFaces(){const e=await n.A.getInterFaces(this.pro.id);200===e.status?this.inetrfaces=e.data:console.log(`获取项目id${this.pro.id}失败`)},async getScenes(){const e=await n.A.getScenes(this.pro.id);200===e.status&&(this.sceneList=e.data)},async getTestTask(){const e=await n.A.getTestTaskList(this.pro.id);200===e.status&&(this.taskList=e.data)}},persist:{enabled:!0,strategies:{key:"users",storage:localStorage}}})},5710:function(e,t,a){function s(e,t){var a={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var s in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?a[s]:("00"+a[s]).substr((""+a[s]).length)));return e}t.A={rTime(e){return s("yyyy-MM-dd hh:mm:ss",new Date(e))},rDate(e){return s("yyyy-MM-dd",new Date(e))},rhost(e){return s("yyyy-MM-dd hh:mm",new Date(e))}}},805:function(e,t,a){a.r(t),a.d(t,{default:function(){return E}});a(4114);var s=a(6768),n=a(144),l=a(4232),i=a(2098),c=a(2469),o=a(1219),r=a(2933),u=a(3851),d=a(1552),k=a(5710),p=a(1387);const f={class:"main_box"},m={class:"card left_box"},g={class:"title_box"},y={class:"card right_box"},b={class:"card"},_={class:"card",style:{"margin-top":"10px"}},h={class:"el-icon-s-help",style:{color:"#17abe3","font-weight":"bold","font-size":"14px"}},v={style:{"font-weight":"bold","font-size":"14px"}},w={class:"card",style:{"margin-top":"10px"}},F={key:0},L={key:0},T={key:0},C={key:0},x={class:"select_content"},R={style:{margin:"10px","text-align":"center"}};var W={__name:"TestPlanView",setup(e){const t=(0,c.N)(),a=(0,p.rd)();let W=(0,n.KR)({id:"",name:""}),z=(0,n.KR)([]),A=(0,n.KR)([]);function E(e){W.value=e,S(),X()}async function M(){if(0==t.sceneList.length)return void(0,o.nk)({type:"error",message:"请添加测试业务后再创建测试计划"});const e={project:t.pro.id,name:"新建测试计划",scene:[t.sceneList[0].id]},a=await d.A.addTestTask(e);201===a.status&&((0,o.nk)({type:"success",message:"添加成功"}),t.getTestTask(),E(a.data))}async function S(){const e=await d.A.getTestTask(W.value.id);200==e.status&&(A.value=e.data.scene)}async function X(){const e=await d.A.getTestRecords({task:W.value.id});200==e.status&&(z.value=e.data)}async function V(e){r.s.confirm("删除后数据不可恢复，确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await d.A.delTestTask(W.value.id);204===e.status&&((0,o.nk)({type:"success",message:"添加成功"}),t.getTestTask(),E(t.taskList[0]))})).catch((()=>{(0,o.nk)({type:"success",message:"添加成功"})}))}async function K(){const e=await d.A.updateTestTask(W.value.id,W.value);200===e.status&&((0,o.nk)({type:"success",message:"保存成功"}),t.getTestTask())}async function D(){if(t.env){const e={env:t.env,task:W.value.id};(0,o.nk)({type:"success",message:"开始运行!"});const a=await d.A.runTestTask(e);200===a.status?(0,u.df)({title:"提示",message:a.data.msg}):(0,o.nk)({type:"error",message:"测试任务运行异常"})}else(0,o.nk)({type:"warning",message:"当前未选中测试环境!"})}async function $(e){console.log(e);let t=[];A.value.forEach((a=>{a.id!==e&&t.push(a.id)}));let a={...W.value};a.scene=t;const s=await d.A.updateTestTask(a.id,a);200===s.status?((0,o.nk)({type:"success",message:"删除成功"}),S()):(0,o.nk)({type:"error",message:"删除失败"})}function Q(e){a.push({name:"report",params:{id:e.id}})}(0,s.sV)((()=>{t.taskList.length>0&&E(t.taskList[0])})),t.getTestTask();let I=(0,n.KR)(!1),P=(0,n.KR)([]);function B(){let e=t.sceneList.filter(((e,t)=>!A.value.find((t=>t.id==e.id))));return e}function N(e){e.forEach((e=>{P.value.push(e.id)}))}const U=(0,n.KR)();async function Y(){let e={...W.value};e.scene.push(...P.value);const t=await d.A.updateTestTask(e.id,e);200===t.status&&((0,o.nk)({type:"success",message:"添加成功"}),S())}return(e,a)=>{const c=(0,s.g2)("el-button"),o=(0,s.g2)("el-menu-item"),r=(0,s.g2)("el-menu"),u=(0,s.g2)("el-divider"),d=(0,s.g2)("el-input"),p=(0,s.g2)("el-col"),S=(0,s.g2)("el-row"),X=(0,s.g2)("el-table-column"),P=(0,s.g2)("el-table"),j=(0,s.g2)("el-tag"),q=(0,s.g2)("el-tooltip"),H=(0,s.g2)("el-drawer");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",f,[(0,s.Lk)("div",m,[(0,s.Lk)("div",g,[a[6]||(a[6]=(0,s.Lk)("img",{src:i,width:"25"},null,-1)),a[7]||(a[7]=(0,s.Lk)("div",{class:"name"},"测试计划",-1)),(0,s.bF)(c,{onClick:M,size:"small",icon:"CirclePlus",plain:""},{default:(0,s.k6)((()=>a[5]||(a[5]=[(0,s.eW)("添加")]))),_:1})]),(0,n.R1)(t).taskList.length>0?((0,s.uX)(),(0,s.Wv)(r,{key:0,"default-active":(0,n.R1)(W).id.toString()},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)((0,n.R1)(t).taskList,(e=>((0,s.uX)(),(0,s.Wv)(o,{onClick:t=>E(e),index:e.id.toString(),key:"item.id"},{default:(0,s.k6)((()=>[a[8]||(a[8]=(0,s.Lk)("img",{src:i,width:"20",style:{"margin-right":"10px"}},null,-1)),(0,s.Lk)("span",null,(0,l.v_)(e.name),1)])),_:2},1032,["onClick","index"])))),128))])),_:1},8,["default-active"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",y,[(0,s.Lk)("div",b,[(0,s.bF)(u,{"content-position":"left"},{default:(0,s.k6)((()=>a[9]||(a[9]=[(0,s.Lk)("b",null,"基本信息",-1)]))),_:1}),(0,n.R1)(W)?((0,s.uX)(),(0,s.Wv)(S,{key:0,gutter:5,style:{"margin-bottom":"20px"}},{default:(0,s.k6)((()=>[(0,s.bF)(p,{span:16},{default:(0,s.k6)((()=>[(0,s.bF)(d,{modelValue:(0,n.R1)(W).name,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,n.R1)(W).name=e),size:"small"},{prepend:(0,s.k6)((()=>a[10]||(a[10]=[(0,s.eW)(" 业务流名称 ")]))),append:(0,s.k6)((()=>[(0,s.bF)(c,{onClick:K,plain:"",icon:"CircleCheck",size:"small",type:"primary"},{default:(0,s.k6)((()=>a[11]||(a[11]=[(0,s.eW)("保存")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(p,{span:8,style:{"text-align":"right"}},{default:(0,s.k6)((()=>[(0,s.bF)(c,{onClick:D,plain:"",size:"small",type:"primary",icon:"el-icon-s-promotion"},{default:(0,s.k6)((()=>a[12]||(a[12]=[(0,s.eW)("运行")]))),_:1}),(0,s.bF)(c,{onClick:V,plain:"",icon:"Delete",size:"small",type:"danger"},{default:(0,s.k6)((()=>a[13]||(a[13]=[(0,s.eW)("删除")]))),_:1})])),_:1})])),_:1})):(0,s.Q3)("",!0)]),(0,s.Lk)("div",_,[(0,s.bF)(u,{"content-position":"left"},{default:(0,s.k6)((()=>a[14]||(a[14]=[(0,s.Lk)("b",null,"本计划执行的业务流",-1)]))),_:1}),(0,s.bF)(P,{data:(0,n.R1)(A),"row-key":"id",style:{width:"100%","margin-bottom":"10px"},"show-header":!1},{default:(0,s.k6)((()=>[(0,s.bF)(X,null,{default:(0,s.k6)((e=>[(0,s.Lk)("span",h,(0,l.v_)("业务流"+(e.$index+1)+": "),1),(0,s.Lk)("span",v,(0,l.v_)(e.row.name),1)])),_:1}),(0,s.bF)(X,{width:"90px"},{default:(0,s.k6)((e=>[(0,s.bF)(c,{plain:"",size:"small",type:"danger",onClick:t=>$(e.row.id),icon:"Delete"},{default:(0,s.k6)((()=>a[15]||(a[15]=[(0,s.eW)("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,s.bF)(c,{onClick:a[1]||(a[1]=e=>(0,n.i9)(I)?I.value=!0:I=!0),plain:"",icon:"Plus",size:"small",type:"primary"},{default:(0,s.k6)((()=>a[16]||(a[16]=[(0,s.eW)("添加测试业务流")]))),_:1})]),(0,s.Lk)("div",w,[(0,s.bF)(u,{"content-position":"left"},{default:(0,s.k6)((()=>a[17]||(a[17]=[(0,s.Lk)("b",null,"执行记录",-1)]))),_:1}),(0,s.bF)(P,{data:(0,n.R1)(z),class:"table-style",size:"small",border:""},{default:(0,s.k6)((()=>[(0,s.bF)(X,{prop:"create_time",label:"执行时间","min-width":"140"},{default:(0,s.k6)((e=>[(0,s.eW)((0,l.v_)((0,n.R1)(k.A).rTime(e.row.create_time)),1)])),_:1}),(0,s.bF)(X,{prop:"env_name",label:"测试环境","min-width":"110"}),(0,s.bF)(X,{prop:"all",label:"总用例","min-width":"50"},{default:(0,s.k6)((e=>["执行中"!==e.row.statue?((0,s.uX)(),(0,s.CE)("span",F,(0,l.v_)(e.row.all),1)):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(X,{label:"通过数","min-width":"50"},{default:(0,s.k6)((e=>["执行中"!==e.row.statue?((0,s.uX)(),(0,s.CE)("span",L,(0,l.v_)(e.row.success),1)):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(X,{label:"通过率","min-width":"80"},{default:(0,s.k6)((e=>["执行中"!==e.row.statue?((0,s.uX)(),(0,s.CE)("span",T,(0,l.v_)(e.row.pass_rate+"%"),1)):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(X,{label:"测试报告",width:"100"},{default:(0,s.k6)((e=>["执行中"===e.row.statue?((0,s.uX)(),(0,s.CE)("span",C,[(0,s.bF)(j,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.row.statue)+"...",1)])),_:2},1024)])):((0,s.uX)(),(0,s.Wv)(c,{key:1,type:"primary",icon:"View",plain:"",size:"small",onClick:t=>Q(e.row)},{default:(0,s.k6)((()=>a[18]||(a[18]=[(0,s.eW)(" 报告 ")]))),_:2},1032,["onClick"]))])),_:1})])),_:1},8,["data"])])])]),(0,s.bF)(H,{modelValue:(0,n.R1)(I),"onUpdate:modelValue":a[4]||(a[4]=e=>(0,n.i9)(I)?I.value=e:I=e),direction:"rtl",size:"30%","show-close":!1},{header:(0,s.k6)((()=>a[19]||(a[19]=[(0,s.Lk)("b",null,"添加测试流程",-1)]))),default:(0,s.k6)((()=>[(0,s.Lk)("div",x,[(0,s.bF)(P,{ref_key:"addRef",ref:U,onSelectionChange:N,size:"small",data:B(),"tooltip-effect":"dark",style:{width:"100%"}},{default:(0,s.k6)((()=>[(0,s.bF)(X,{type:"selection","min-width":"40"}),(0,s.bF)(X,{prop:"name",label:"全选","min-width":"120"})])),_:1},8,["data"])]),(0,s.Lk)("div",R,[(0,s.bF)(q,{class:"item",effect:"dark",content:"添加选中测试流程到任务中",placement:"top-start"},{default:(0,s.k6)((()=>[(0,s.bF)(c,{onClick:Y,plain:"",type:"success",size:"small"},{default:(0,s.k6)((()=>a[20]||(a[20]=[(0,s.eW)("确认添加")]))),_:1})])),_:1}),(0,s.bF)(q,{class:"item",effect:"dark",content:"清除选中选项",placement:"top-start"},{default:(0,s.k6)((()=>[(0,s.bF)(c,{plain:"",type:"warning",size:"small",onClick:a[2]||(a[2]=t=>e.$refs.addRef.clearSelection())},{default:(0,s.k6)((()=>a[21]||(a[21]=[(0,s.eW)("清除选中")]))),_:1})])),_:1}),(0,s.bF)(q,{class:"item",effect:"dark",content:"关闭当前窗口",placement:"top-start"},{default:(0,s.k6)((()=>[(0,s.bF)(c,{plain:"",type:"danger",size:"small",onClick:a[3]||(a[3]=e=>(0,n.i9)(I)?I.value=!1:I=!1)},{default:(0,s.k6)((()=>a[22]||(a[22]=[(0,s.eW)("关闭窗口")]))),_:1})])),_:1})])])),_:1},8,["modelValue"])],64)}}},z=a(1241);const A=(0,z.A)(W,[["__scopeId","data-v-70c88df5"]]);var E=A}}]);
//# sourceMappingURL=805.76bf181b.js.map